<html>
<head>
    <title>UnitAI Execution Report</title>
</head>
<body>
<style>
    body {
        background-color: #505050;
        color: #d9d8d8;
    }

    .node {
        cursor: pointer;
    }

    textarea {
        width: 1100px;
        height: 600px;
        background-color: #2f2f2f;
        color: #d9d8d8;
        max-height: 600px;
    }

    pre {
        font-family: monospace;
        background-color: #2f2f2f;
        max-width: 70%;
    }
</style>
<script>
    const root = __JSON_TREE__;

    // Explore tree from root and create a tree hashmap by node.id
    const treeMap = {};
    const stack = [root];
    while (stack.length > 0) {
        const node = stack.pop();
        treeMap[node.count] = node;
        if (node.children) {
            node.children.forEach((child) => {
                stack.push(child);
            });
        }
    }
    console.log(treeMap)

    document.addEventListener('DOMContentLoaded', () => {
        const lis = [...document.getElementsByClassName('node')];
        lis.forEach((li) => {
            console.log(li)
            li.addEventListener('click', (event) => {
                const id = event.target.id;
                const node = treeMap[id];
                console.log(node);
                let allErrors = '';
                for (let i = 0; i < node.errors.length; i++) {
                    const error = node.errors[i];
                    allErrors += `######## ERROR ${i} ########\n\n${error}\n\n`;
                }
                const mainDiv = document.getElementById('main');
                mainDiv.innerHTML = `
                Count: ${node.count}<br/>
                Score: ${node.score}<br/>
                Temperature: ${node.temperature}<br/><br/>
                <h2>AI Prompt:</h2>
                <textarea>${node.prompt}</textarea>
                <h2>AI Output:</h2>
                <textarea>${node.ai_output}</textarea>
                <h2>Errors:</h2>
                <pre>${allErrors}</pre>
            `
                const entitiesDiv = document.getElementById('entities');
                entitiesDiv.innerHTML = '';
                //    def __init__(self, orig_func: str):
                // self.orig_func = orig_func
                // self.orig_code = inspect.getsource(orig_func)
                // self.func_name = orig_func.__name__
                // self.impl = None
                for (const [entityName, impl] of Object.entries(node.impls)) {
                    entitiesDiv.innerHTML += `
                    <div>
                        <h2>Entity: ${entityName}</h2>
                        <p>Implementation:</p>
                        <textarea>${impl}</textarea>
                    </div>
                `
                }
            });

        });
    });
</script>
<h1>UnittestAI Execution Report</h1>
<div style="float:left; min-width: 400px;">
    __TREE__
</div>
<div style="float:left; margin-left: 20px;">
    <div id="main">
        Click on a node to see details
    </div>
    <div id="entities"></div>
</div>
<div style="padding:30px; margin-top:50px;">
    <img src="__TREE_IMG__" style="max-width: 100%;"/>
</div>
</body>
</html>